<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SLOPE.EXE</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
    background: #050510;
    color: #00ff88;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

canvas {
    display: block;
}

.hud {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    z-index: 10;
}

.hud div {
    margin-bottom: 5px;
    font-weight: bold;
}

.back-btn {
    position: absolute;
    top: 20px;
    left: 20px;
    color: #00ff88;
    text-decoration: none;
    border: 2px solid #00ff88;
    padding: 8px 14px;
}

.game-over {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.9);
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    color: white;
    z-index: 20;
}
</style>
</head>

<body>

<script>
/* AUTH CHECK */
if (sessionStorage.getItem("authenticated") !== "true") {
    window.location.href = "index.html";
}
const username = localStorage.getItem("username") || "UNKNOWN";
</script>

<a href="index.html" class="back-btn">‚Üê BACK</a>

<div class="hud">
    <div>SCORE: <span id="score">0</span></div>
    <div>SPEED: <span id="speed">1.0</span>x</div>
    <div>HIGH SCORE: <span id="highScore">0</span></div>
</div>

<div class="game-over" id="gameOver">
    <h1>GAME OVER</h1>
    <p>FINAL SCORE: <span id="finalScore"></span></p>
    <p id="newHigh" style="display:none;">üèÜ NEW HIGH SCORE!</p>
    <button onclick="restartGame()">RESTART</button>
    <a href="index.html" style="color:white;margin-top:20px;">BACK TO MENU</a>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight;

/* HIGH SCORE SYSTEM */
let highScoreData = JSON.parse(localStorage.getItem("slopeHighScore")) || {
    score: 0,
    user: "NONE"
};

document.getElementById("highScore").textContent =
`${highScoreData.score} (${highScoreData.user})`;

let score = 0;
let speed = 5;
let running = true;

/* PLAYER */
const player = {
    x: canvas.width / 2,
    y: canvas.height - 150,
    r: 12,
    vx: 0
};

let obstacles = [];
const keys = {};

/* INPUT */
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

/* GAME LOOP */
function update() {
    if (!running) return;

    if (keys["ArrowLeft"] || keys["a"]) player.vx = -7;
    else if (keys["ArrowRight"] || keys["d"]) player.vx = 7;
    else player.vx *= 0.9;

    player.x += player.vx;
    speed += 0.001;
    score += 0.2;

    if (Math.random() < 0.02) {
        obstacles.push({
            x: Math.random() * canvas.width,
            y: -20,
            s: 30
        });
    }

    obstacles.forEach(o => o.y += speed);
    obstacles = obstacles.filter(o => o.y < canvas.height);

    for (let o of obstacles) {
        const dx = player.x - o.x;
        const dy = player.y - o.y;
        if (dx*dx + dy*dy < (player.r + o.s/2)**2) {
            gameOver();
        }
    }

    document.getElementById("score").textContent = Math.floor(score);
    document.getElementById("speed").textContent = (speed/5).toFixed(1);
}

function draw() {
    ctx.fillStyle = "rgba(5,5,16,0.3)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle = "#00ff88";
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
    ctx.fill();

    ctx.fillStyle = "#ff3333";
    obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.s, o.s));
}

function loop() {
    update();
    draw();
    if (running) requestAnimationFrame(loop);
}
loop();

function gameOver() {
    running = false;
    document.getElementById("gameOver").style.display = "flex";
    document.getElementById("finalScore").textContent = Math.floor(score);

    if (score > highScoreData.score) {
        highScoreData = {
            score: Math.floor(score),
            user: username
        };
        localStorage.setItem("slopeHighScore",
            JSON.stringify(highScoreData));

        document.getElementById("highScore").textContent =
            `${highScoreData.score} (${username})`;
        document.getElementById("newHigh").style.display = "block";
    }
}

function restartGame() {
    score = 0;
    speed = 5;
    obstacles = [];
    running = true;
    document.getElementById("gameOver").style.display = "none";
    loop();
}

window.addEventListener("resize", () => {
    canvas.width = innerWidth;
    canvas.height = innerHeight;
});
</script>

</body>
</html>
